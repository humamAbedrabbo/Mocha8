@using Microsoft.AspNetCore.Identity

@inject SignInManager<AmsUser> SignInManager
@inject UserManager<AmsUser> UserManager
@inject AMS.Services.IUserService userService

@{ 
    AmsUser user = await userService.GetCurrentUserAsync();
}

<li class="nav-item dropdown">
  <a class="nav-link" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
    <img class="img-avatar" src="@user?.PictureUrl" alt="@user?.Email" title="@user?.DisplayName">
  </a>
  <div class="dropdown-menu dropdown-menu-right">
      <div class="dropdown-header text-center">
          <strong>Account</strong>
      </div>

      <a class="dropdown-item" asp-area="" asp-controller="My" asp-action="TodoTasks">
          <i class="fa fa-tasks"></i> My Tasks
          <span class="badge badge-danger">@(await userService.GetUserTasksCount(userId: user?.Id ?? 0))</span>
      </a>

      <div class="dropdown-header text-center">
          <strong>Settings</strong>
      </div>

      <a class="dropdown-item" asp-area="Identity" asp-controller="Users" asp-action="Details" title="User Profile">
          <i class="fa fa-user"></i> Profile
      </a>

      <a class="dropdown-item" href="#">
          <i class="fa fa-wrench"></i> Settings
      </a>
      <a class="dropdown-item" asp-area="" asp-controller="My" asp-action="UserGroups">
          <i class="fa fa-usd"></i> User Groups
          <span class="badge badge-secondary">@(await userService.GetUserUserGroupsCount(userId: user?.Id ?? 0))</span>
      </a>
      <a class="dropdown-item" href="#">
          <i class="fa fa-file"></i> Assets
          <span class="badge badge-primary">@(await userService.GetUserAssetsCount(userId: user?.Id ?? 0))</span>
      </a>
      <div class="divider"></div>

      <a class="dropdown-item" href="/Identity/Account/Manage/ChangePassword">
          <i class="fa fa-lock"></i> Change Password
          <span class="badge badge-primary"></span>
      </a>

      <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Page("/Index", new {area = ""})" method="post" id="logoutForm">
          <script>
              function logout() {
                  $('#logoutForm').submit();
              }
          </script>
          <a class="dropdown-item" href="javascript: void(0)" onclick="logout()">
              <i class="fa fa-lock"></i> Logout
          </a>
      </form>

  </div>
</li>
